/* dog 1.0.0*/ 
function authHandler(a,b){if(a)showError(oError,"邮箱或密码错误"),console.log(b);else{var c=oUn.val(),d=b.uid,e=d.split(":")[1],f=ref.child("users"),g=null,h=function(){g?(console.log("用户 UID 已存在"),oLoginBtn.prop("disabled",!1)):(f.child(d).update({user_id:e,email:c,time:oDateNow,money:oRMony}),console.log("写入用户相关信息"),oLoginBtn.prop("disabled",!1)),showError(oError,"登录成功")};console.log("用户已登录："+e),f.orderByChild("user_id").equalTo(e).on("child_added",function(a){g=a.key()}),setTimeout(h,1500)}}function authDataCallback(a){a?console.log(" Uid: "+a.uid+" 以某种方式登录: "+a.provider+" Token: "+a.token):console.log("用户已登出")}var ref=new Wilddog("https://migong.wilddogio.com"),oUn=$("#username"),oPw=$("#password"),oRegisterBtn=$("#registerBtn"),oLoginBtn=$("#loginBtn"),oforgetPwBtn=$("#forgetPasswordBtn"),oResetPwBtn=$("#resetPasswordBtn"),oError=$(".error"),oEmail=/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/,showError=function(a,b){a.find("p").fadeIn().text(b),setTimeout(function(){a.find("p").fadeOut()},5e3)},verify=function(a){console.log(a);var b=oUn.val(),c=oPw.val();return 0===b.length?(showError(oError,"邮箱不能为空"),!1):oEmail.test(b)?0===c.length?(showError(oError,"密码不能为空"),!1):void("registerBtn"==a?(oRegisterBtn.prop("disabled",!0),ref.createUser({email:b,password:c},function(a,b){if(null!==a)showError(oError,a);else{var c=b.uid.split(":");showError(oError,"注册成功："+c[1]),oRegisterBtn.prop("disabled",!1)}})):"loginBtn"==a&&(oLoginBtn.prop("disabled",!0),ref.authWithPassword({email:b,password:c},authHandler))):(showError(oError,"邮箱格式不正确"),!1)};oRegisterBtn.on("click",function(){var a=$(this).prop("id");verify(a)}),oLoginBtn.on("click",function(){var a=$(this).prop("id");verify(a)}),oforgetPwBtn.on("click",function(){var a=$(".resetPasswordBox");a.toggle()}),oResetPwBtn.on("click",function(){var a=$("#resetPassword").val().trim();return 0===a.length?(showError(oError,"邮箱不能为空"),!1):oEmail.test(a)?(oResetPwBtn.prop("disabled",!0),void ref.resetPassword({email:a},function(a){null===a?(showError(oError,"重置密码成功"),oResetPwBtn.prop("disabled",!1)):(oResetPwBtn.prop("disabled",!1),showError(oError,a))})):(showError(oError,"邮箱格式不正确"),!1)}),$("#logOut").click(function(){ref.unauth()}),ref.onAuth(authDataCallback);